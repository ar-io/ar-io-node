---
version: '3.0'

networks:
  ario:

services:
  envoy:
    build:
        context: envoy/
        dockerfile: Dockerfile
    ports:
      - '1984:1984'
      - '9901:9901'
    networks:
      - ario
    environment:
      - ARIO_HOST=ar.io
      - ARIO_PORT=3000
      - ARWEAVE_GATEWAY=arweave.net
      - LOG_LEVEL=trace

  ario:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 3000:3000
    volumes:
      - ./data/sqlite:/data/sqlite
    networks:
      ario:
        aliases:
            - ar.io
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    environment:
      ENV: development