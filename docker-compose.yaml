---
version: '3.0'

networks:
  ario:

services:
  envoy:
    build:
        context: envoy/
        dockerfile: Dockerfile
    ports:
      - '1984:1984'
      - '9901:9901'
    networks:
      - ario
    environment:
      - ARIO_GATEWAYS=ar.io:3000
      - ARWEAVE_NODES=node-ny-247rack-1.ar.io:1984,node-ny-247rack-2.ar.io:1984,chain-ny-247rack-1.ar.io:1984
      - ECS_PROMETHEUS_EXPORTER_PORT=9901
      - ECS_PROMETHEUS_EXPORTER_METRICS_PATH=/stats/prometheus
      - LOG_LEVEL=debug

  ario:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 3000:3000
    volumes:
      - ./data/sqlite/standalone.db:/data/sqlite/standalone.db
    networks:
      ario:
        aliases:
            - ar.io
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    environment:
      ENV: development