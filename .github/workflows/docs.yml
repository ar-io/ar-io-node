name: Build docs and deploy as GitHub pages

on:
  workflow_dispatch:
  push:
    branches:
      - develop

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 2

    - name: Install Graphviz and OpenJDK (for PlantUML)
      run: |
        sudo apt-get update
        sudo apt-get install -y graphviz openjdk-11-jdk-headless

    - name: Setup Babashka
      uses: turtlequeue/setup-babashka@v1.5.0
      with:
        babashka-version: 1.3.188

    - name: Send diagrams notifications
      env:
        SLACK_API_TOKEN: ${{ secrets.SLACK_API_TOKEN }}
        SLACK_CHANNEL: ${{ secrets.SLACK_CHANNEL }}
      run: bb send-diagram-notifications
